/**
* Media Grid Editor + FrontEnd Styles
*
* CSS for both Frontend+Backend.
*/

$columns: 5;

// Media Grid specific styles with higher specificity
.gmfgb-mg-grid {
	display: flex;
    flex-wrap: wrap;
	margin: 0;
	font-size: 0;
	position: relative;
	row-gap: 20px; /* Default row gap */
	column-gap: 20px; /* Default column gap */
	border: none;
	// Apply custom gutter values when available
	&[data-gutter-desktop][data-gutter-tablet][data-gutter-mobile] {
		// Row gap always 20px, column gap uses gutter value
		row-gap: 20px;
		column-gap: var(--gutter-desktop, 20px);
	}
	
	// Responsive grid with data attributes - Higher specificity
	&[data-grid-desktop][data-grid-tablet][data-grid-mobile] {
		// Desktop styles (1024px and above)
		@media (min-width: 1024px) {
			row-gap: 20px;
			column-gap: var(--gutter-desktop, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-desktop, 20px) * (var(--grid-desktop, 3) - 1))) / var(--grid-desktop, 3)) !important;
				margin-bottom: 0;
			}
		}

		// Tablet styles (768px to 1023px) - Includes iPad
		@media (min-width: 768px) and (max-width: 1023px) {
			row-gap: 20px;
			column-gap: var(--gutter-tablet, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-tablet, 20px) * (var(--grid-tablet, 2) - 1))) / var(--grid-tablet, 2)) !important;
				margin-bottom: 0;
			}
		}

		// Mobile styles (below 768px) - Includes all mobile devices
		@media (max-width: 767px) {
			row-gap: 20px;
			column-gap: var(--gutter-mobile, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-mobile, 20px) * (var(--grid-mobile, 1) - 1))) / var(--grid-mobile, 1)) !important;
				margin-bottom: 0;
			}
		}
	}
	
	// Frontend specific styles - ensure gutter values are applied
	&[data-gutter-desktop][data-gutter-tablet][data-gutter-mobile] {
		// Desktop styles (1024px and above)
		@media (min-width: 1024px) {
			row-gap: 20px;
			column-gap: var(--gutter-desktop, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-desktop, 20px) * (var(--grid-desktop, 3) - 1))) / var(--grid-desktop, 3)) !important;
				margin-bottom: 0;
			}
		}

		// Tablet styles (768px to 1023px) - Includes iPad
		@media (min-width: 768px) and (max-width: 1023px) {
			row-gap: 20px;
			column-gap: var(--gutter-tablet, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-tablet, 20px) * (var(--grid-tablet, 2) - 1))) / var(--grid-tablet, 2)) !important;
				margin-bottom: 0;
			}
		}

		// Mobile styles (below 768px) - Includes all mobile devices
		@media (max-width: 767px) {
			row-gap: 20px;
			column-gap: var(--gutter-mobile, 20px);
			
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc((100% - (var(--gutter-mobile, 20px) * (var(--grid-mobile, 1) - 1))) / var(--grid-mobile, 1)) !important;
				margin-bottom: 0;
			}
		}
	}
	
	// Fallback styles for blocks without data attributes (lower specificity)
	&:not([data-grid-desktop]) {
		// Default desktop styles (fallback) - 1024px and above
		@media (min-width: 1024px) {
			@for $i from 1 through $columns {
				&.grid-size-#{$i} {
					row-gap: 20px;
					column-gap: 20px;
					.gmfgb-mg-media,
					.gmfgb-mg-button,
					.gmfgb-mg-wrap {
						width: calc((100% - (20px * ($i - 1))) / $i);
						margin-bottom: 0;
					}
				}
			}
		}

		// Tablet styles (fallback) - 768px to 1023px
		@media (min-width: 768px) and (max-width: 1023px) {
			row-gap: 20px;
			column-gap: 20px;
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: calc(50% - 10px);
				margin-bottom: 0;
			}
		}

		// Mobile styles (fallback) - below 768px
		@media (max-width: 767px) {
			row-gap: 20px;
			column-gap: 20px;
			.gmfgb-mg-media,
			.gmfgb-mg-button,
			.gmfgb-mg-wrap {
				width: 100%;
				margin-bottom: 0;
			}
		}
	}
	
	// Ensure default 20px gaps for any media grid without specific gutter settings
	&:not([data-gutter-desktop]):not([data-gutter-tablet]):not([data-gutter-mobile]) {
		row-gap: 20px;
		column-gap: 20px;
		
		@media (min-width: 1024px) {
			row-gap: 20px;
			column-gap: 20px;
		}
		
		@media (min-width: 768px) and (max-width: 1023px) {
			row-gap: 20px;
			column-gap: 20px;
		}
		
		@media (max-width: 767px) {
			row-gap: 20px;
			column-gap: 20px;
		}
	}
}

// Isotope-specific styles for media grid
.gmfgb-mg-grid.isotope-initialized {
	display: block !important;
	row-gap: 20px !important; /* Maintain 20px row gap even with Isotope */
	column-gap: 0; /* Isotope handles column spacing internally */
	
	.gmfgb-mg-media {
		position: absolute;
		width: calc((100% - (var(--gutter-desktop, 20px) * (var(--grid-desktop, 3) - 1))) / var(--grid-desktop, 3));
		margin-bottom: 20px !important; /* Add bottom margin for row spacing */
		
		// Tablet styles (768px to 1023px) - Includes iPad
		@media (min-width: 768px) and (max-width: 1023px) {
			width: calc((100% - (var(--gutter-tablet, 20px) * (var(--grid-tablet, 2) - 1))) / var(--grid-tablet, 2));
			margin-bottom: 20px !important; /* Add bottom margin for row spacing */
		}
		
		// Mobile styles (below 768px) - Includes all mobile devices
		@media (max-width: 767px) {
			width: calc((100% - (var(--gutter-mobile, 20px) * (var(--grid-mobile, 1) - 1))) / var(--grid-mobile, 1));
			margin-bottom: 20px !important; /* Add bottom margin for row spacing */
		}
	}
}

// Admin editor specific styles to prevent conflicts
.editor-styles-wrapper .gmfgb-mg-grid {
	// Ensure proper isolation in admin editor
	z-index: 1;
	position: relative;
	
	// Ensure gutter spacing works in editor
	row-gap: 20px !important;
	column-gap: var(--gutter-desktop, 20px) !important;
	
	// Responsive gutter spacing for editor
	@media (min-width: 768px) and (max-width: 1023px) {
		column-gap: var(--gutter-tablet, 20px) !important;
	}
	
	@media (max-width: 767px) {
		column-gap: var(--gutter-mobile, 20px) !important;
	}
	
	// Prevent conflicts with post grid
	&:not(.isotope-initialized) {
		display: flex !important;
		flex-wrap: wrap !important;
		
		.gmfgb-mg-media {
			position: relative !important;
			left: unset !important;
			top: unset !important;
		}
		
		.gmfgb-mg-wrap {
			position: relative !important;
			left: unset !important;
			top: unset !important;
			width: calc((100% - (var(--gutter-desktop, 20px) * (var(--grid-desktop, 3) - 1))) / var(--grid-desktop, 3)) !important;
			
			@media (min-width: 768px) and (max-width: 1023px) {
				width: calc((100% - (var(--gutter-tablet, 20px) * (var(--grid-tablet, 2) - 1))) / var(--grid-tablet, 2)) !important;
			}
			
			@media (max-width: 767px) {
				width: calc((100% - (var(--gutter-mobile, 20px) * (var(--grid-mobile, 1) - 1))) / var(--grid-mobile, 1)) !important;
			}
		}
	}
}

// Frontend-specific styles to ensure row gap works
body:not(.wp-admin) .gmfgb-mg-grid {
	row-gap: 20px !important;
	
	&.isotope-initialized {
		.gmfgb-mg-media {
			margin-bottom: 20px !important;
		}
	}
	
	&:not(.isotope-initialized) {
		row-gap: 20px !important;
		column-gap: var(--gutter-desktop, 20px) !important;
		
		@media (min-width: 1024px) {
			row-gap: 20px !important;
			column-gap: var(--gutter-desktop, 20px) !important;
		}
		
		@media (min-width: 768px) and (max-width: 1023px) {
			row-gap: 20px !important;
			column-gap: var(--gutter-tablet, 20px) !important;
		}
		
		@media (max-width: 767px) {
			row-gap: 20px !important;
			column-gap: var(--gutter-mobile, 20px) !important;
		}
	}
}

// Additional frontend-specific rules with higher specificity
body:not(.wp-admin) .gmfgb-mg-grid[data-gutter-desktop][data-gutter-tablet][data-gutter-mobile] {
	row-gap: 20px !important;
	
	@media (min-width: 1024px) {
		row-gap: 20px !important;
		column-gap: var(--gutter-desktop, 20px) !important;
	}
	
	@media (min-width: 768px) and (max-width: 1023px) {
		row-gap: 20px !important;
		column-gap: var(--gutter-tablet, 20px) !important;
	}
	
	@media (max-width: 767px) {
		row-gap: 20px !important;
		column-gap: var(--gutter-mobile, 20px) !important;
	}
}

.gmfgb-mg-fancy-custom {
	.fancybox-video,
	.fancybox-image {
		position: static !important;
	}
}

.image-caption {
	position: absolute;
	left: 0;
	width: 100%;
	padding: 12px;
	background-color: rgba(0, 0, 0, 0.25);
	z-index: 1;
	color: #fff;
	max-height: 70%;
	overflow: auto;
	font-size: 16px;
	text-align: left;
	&.caption-pos-top {
		top: 0;
		bottom: unset;
		transform: none;
	}
	&.caption-pos-bottom {
		bottom: 0;
		top: unset;
		transform: none;
	}
	&.caption-pos-center {
		top: 50%;
		bottom: unset;
		transform: translateY(-50%);
		display: flex;
		align-items: center;
		justify-content: center;
		text-align: center;
	}
}

// Responsive font size for caption (front-end only, using attribute selectors)
.image-caption.caption-pos-bottom[data-caption-font-desktop] {
    font-size: inherit;
}
.components-base-control select,
.components-flex-item label.components-text-control__label {
	text-transform: capitalize;
}
@media (min-width: 768px) {
    .image-caption.caption-pos-bottom[data-caption-font-desktop] {
        font-size: unset;
        font-size: /*[[captionFontSizeDesktop]]*/ 16px;
    }
}
@media (min-width: 561px) and (max-width: 767px) {
    .image-caption.caption-pos-bottom[data-caption-font-desktop] {
        font-size: unset;
        font-size: /*[[captionFontSizeDesktop]]*/ 16px;
    }
}
@media (min-width: 320px) and (max-width: 560px) {
    .image-caption.caption-pos-bottom[data-caption-font-desktop] {
        font-size: unset;
        font-size: /*[[captionFontSizeDesktop]]*/ 16px;
    }
}

.gmfgb-mg-media {
    position: relative;
	padding: 0;
	box-sizing: border-box;
	font-size: 0;
	border-radius: var(--border-radius-desktop-top, 0px) var(--border-radius-desktop-right, 0px) var(--border-radius-desktop-bottom, 0px) var(--border-radius-desktop-left, 0px);
	overflow: hidden;
    > a {
        display: block;
    }
    img {
        width: 100%;
    }
	svg {
		background: #ffffff;
		padding: 5px;
		position: absolute;
		top: 20px;
		left: 20px;
		border-radius: 100px;
		z-index: 2;
	}
	
	// Apply border only when border type is not 'none'
	&:not([data-border-type-desktop="none"]) {
		border-top: var(--border-width-desktop-top, 0px) var(--border-type-desktop, none) var(--border-color-desktop);
		border-right: var(--border-width-desktop-right, 0px) var(--border-type-desktop, none) var(--border-color-desktop);
		border-bottom: var(--border-width-desktop-bottom, 0px) var(--border-type-desktop, none) var(--border-color-desktop);
		border-left: var(--border-width-desktop-left, 0px) var(--border-type-desktop, none) var(--border-color-desktop);
	}
	
	// Tablet styles - Use desktop values for consistency
	@media (min-width: 561px) and (max-width: 767px) {
		border-radius: var(--border-radius-desktop-top, 0px) var(--border-radius-desktop-right, 0px) var(--border-radius-desktop-bottom, 0px) var(--border-radius-desktop-left, 0px);
		
		&:not([data-border-type-desktop="none"]) {
			border-top-width: var(--border-width-desktop-top, 0px);
			border-right-width: var(--border-width-desktop-right, 0px);
			border-bottom-width: var(--border-width-desktop-bottom, 0px);
			border-left-width: var(--border-width-desktop-left, 0px);
			border-style: var(--border-type-desktop, none);
			border-color: var(--border-color-desktop, #000);
		}
	}
	
	// Mobile styles - Use desktop values for consistency
	@media (min-width: 320px) and (max-width: 560px) {
		border-radius: var(--border-radius-desktop-top, 0px) var(--border-radius-desktop-right, 0px) var(--border-radius-desktop-bottom, 0px) var(--border-radius-desktop-left, 0px);
		
		&:not([data-border-type-desktop="none"]) {
			border-top-width: var(--border-width-desktop-top, 0px);
			border-right-width: var(--border-width-desktop-right, 0px);
			border-bottom-width: var(--border-width-desktop-bottom, 0px);
			border-left-width: var(--border-width-desktop-left, 0px);
			border-style: var(--border-type-desktop, none);
			border-color: var(--border-color-desktop, #000);
		}
	}
}

// Override WordPress core rule that forces border-style: solid
.gmfgb-mg-media {
	&[style*="border-width"] {
		border-style: var(--border-type-desktop, none) !important;
	}
}

.gmfgb-mg-columns-setting {
	button:nth-child(3) {
		svg {
			width: 20px;
			height: 20px;
		}
	}
}

// Fallback mechanism using data attributes for gutter spacing
.gmfgb-mg-grid[data-gutter-desktop][data-gutter-tablet][data-gutter-mobile] {
	// Desktop fallback
	&[data-gutter-desktop="10"] { column-gap: 10px !important; }
	&[data-gutter-desktop="15"] { column-gap: 15px !important; }
	&[data-gutter-desktop="20"] { column-gap: 20px !important; }
	&[data-gutter-desktop="25"] { column-gap: 25px !important; }
	&[data-gutter-desktop="30"] { column-gap: 30px !important; }
	&[data-gutter-desktop="35"] { column-gap: 35px !important; }
	&[data-gutter-desktop="40"] { column-gap: 40px !important; }
	&[data-gutter-desktop="45"] { column-gap: 45px !important; }
	&[data-gutter-desktop="50"] { column-gap: 50px !important; }
	
	// Tablet fallback
	@media (min-width: 561px) and (max-width: 767px) {
		&[data-gutter-tablet="10"] { column-gap: 10px !important; }
		&[data-gutter-tablet="15"] { column-gap: 15px !important; }
		&[data-gutter-tablet="20"] { column-gap: 20px !important; }
		&[data-gutter-tablet="25"] { column-gap: 25px !important; }
		&[data-gutter-tablet="30"] { column-gap: 30px !important; }
		&[data-gutter-tablet="35"] { column-gap: 35px !important; }
		&[data-gutter-tablet="40"] { column-gap: 40px !important; }
		&[data-gutter-tablet="45"] { column-gap: 45px !important; }
		&[data-gutter-tablet="50"] { column-gap: 50px !important; }
	}
	
	// Mobile fallback
	@media (min-width: 320px) and (max-width: 560px) {
		&[data-gutter-mobile="10"] { column-gap: 10px !important; }
		&[data-gutter-mobile="15"] { column-gap: 15px !important; }
		&[data-gutter-mobile="20"] { column-gap: 20px !important; }
		&[data-gutter-mobile="25"] { column-gap: 25px !important; }
		&[data-gutter-mobile="30"] { column-gap: 30px !important; }
		&[data-gutter-mobile="35"] { column-gap: 35px !important; }
		&[data-gutter-mobile="40"] { column-gap: 40px !important; }
		&[data-gutter-mobile="45"] { column-gap: 45px !important; }
		&[data-gutter-mobile="50"] { column-gap: 50px !important; }
	}
}
.image-caption.caption-pos-top,
.image-caption.caption-pos-center,
.image-caption.caption-pos-bottom {
    font-size: var(--caption-font-size-desktop, 16px);
}
@media (min-width: 561px) and (max-width: 767px) {
    .image-caption.caption-pos-top,
	.image-caption.caption-pos-center,
	.image-caption.caption-pos-bottom {
        font-size: var(--caption-font-size-desktop, 16px);
    }
}
@media (min-width: 320px) and (max-width: 560px) {
    .image-caption.caption-pos-top,
	.image-caption.caption-pos-center,
	.image-caption.caption-pos-bottom {
        font-size: var(--caption-font-size-desktop, 16px);
    }
}